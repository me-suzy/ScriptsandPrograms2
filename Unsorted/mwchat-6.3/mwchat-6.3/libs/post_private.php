<?PHP
  function Post_Private($szPostUser, $szPostMsg) { global $Room; global $Username; global $CONN; global $STATUS; global $LOCALE; $szPostMsg = Profanity_Check($szPostMsg, "clean"); $szPostMsg = "<FONT COLOR=\"$STATUS[TextColor]\">$szPostMsg</FONT COLOR>"; $szPostMsg = addslashes($szPostMsg); $rgUsers_SELECT = db_query("SELECT room, block_all, away FROM chat_users WHERE username='$szPostUser'", $CONN); $szUsers = db_numrows($rgUsers_SELECT); if ($szUsers == "1") { while($rgUsers = db_fetch($rgUsers_SELECT)) { $szPostRoom = $rgUsers[room]; $szBlocked = $rgUsers[block_all]; $szAway = $rgUsers[away]; } if ($szBlocked == "no" and $szAway == "no") { $rgRegistered_SELECT = db_query("SELECT ignored_users FROM chat_registered WHERE username='$szPostUser'", $CONN); while($rgIgnoreInfo = db_fetch($rgRegistered_SELECT)) { if (preg_match("/\*$Username\*/", $rgIgnoreInfo[ignored_users])) { $szIgnored = "TRUE"; } } if ($szIgnored == "TRUE") { Post_System("<I>$szPostUser $LOCALE[COMMON_Not_Accept]</I>", "syntax", $Room); } else { $rgEncryptMsg = Encryption("encode", $szPostMsg, $szPostUser, ""); $rgText_INSERT = db_query("INSERT INTO chat_text VALUES(NULL, '$szPostUser', '$Username', 'yes', '$szPostRoom', '$rgEncryptMsg[0]', '$rgEncryptMsg[1]', NULL)", $CONN); $rgEncryptMsg = Encryption("encode", $szPostMsg, $Username, ""); $rgText_INSERT = db_query("INSERT INTO chat_text VALUES(NULL, '$Username', '$Username', 'yes', '$Room', '$rgEncryptMsg[0]', '$rgEncryptMsg[1]', '$szPostUser')", $CONN); } } else { Post_System("<I>$szPostUser $LOCALE[COMMON_Not_Accept]</I>", "syntax", $Room); } } else { Post_System("<I>$szPostUser $LOCALE[DIALOG_Not_Online]</I>", "syntax", $Room); } } ?>
