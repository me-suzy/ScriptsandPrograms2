<?PHP
  function Encryption($szEncrypt_type, $szEncrypt_msg, $szEncrypt_key, $szEncrypt_vector) { global $CONFIG; global $LOCALE; if ($CONFIG[Database_Encryption] == "true") { if (!is_callable(mcrypt_create_iv) or !is_callable(mcrypt_encrypt) or !is_callable(mcrypt_decrypt)) { ChatLog($LOCALE[COMMON_No_Encryption]); return array($szEncrypt_msg, "NO_ENCRYPT"); } $szEncrypt_key = substr($szEncrypt_key, 0, 8); if ($szEncrypt_type == "decode") { $szDecoded_vector = base64_decode(rawurldecode($szEncrypt_vector)); $szEncrypt_msg = base64_decode(rawurldecode($szEncrypt_msg)); $szDecoded = mcrypt_decrypt(MCRYPT_DES, $szEncrypt_key, $szEncrypt_msg, MCRYPT_MODE_ECB, $szDecoded_vector); return array($szDecoded, $szDecoded_vector); } else { $szEncrypt_vector = mcrypt_create_iv (mcrypt_get_iv_size (MCRYPT_DES, MCRYPT_MODE_ECB), MCRYPT_RAND); $szEncoded = mcrypt_encrypt(MCRYPT_DES, $szEncrypt_key, $szEncrypt_msg, MCRYPT_MODE_ECB, $szEncrypt_vector); $szEncoded = rawurlencode(base64_encode($szEncoded)); $szEncoded_vector = rawurlencode(base64_encode($szEncrypt_vector)); return array($szEncoded, $szEncoded_vector); } } else { return array($szEncrypt_msg, "NO_ENCRYPT"); } } ?>
