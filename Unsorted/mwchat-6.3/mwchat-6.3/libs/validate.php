<?PHP
  function Validate($SQLid, $SQLDelName='FALSE', $SQLDelVar='FALSE') { global $CONFIG; global $CONN; $szServerAddr = getenv('SERVER_ADDR'); $rgLicense_SELECT = db_query("SELECT * FROM chat_license where sql_id='$SQLid'", $CONN); while($rgLicense = db_fetch($rgLicense_SELECT)) { $szSQLCommand = base64_decode(rawurldecode($rgLicense[sql_data])); $szSQLTestKey = md5("$rgLicense[sql_id]-$szServerAddr-$rgLicense[sql_data]-$CONFIG[System_Serial]-$CONFIG[System_Version]"); if ($szSQLTestKey != trim($rgLicense[sql_key]) and $CONFIG[System_Dynamic] != "true") { Error("ERROR_License"); } } if ($szSQLCommand == "" or !isset($szSQLCommand)) { Error("ERROR_License"); } global $Username; global $Room; global $Query; global $rgRooms; global $rgMatches; global $rgArgs; global $Sequence_Check; global $STATUS; if ($SQLDelName != "FALSE" and $SQLDelVar != "FALSE") { $szSQLCommand = preg_replace("/\\\$$SQLDelName/", "$SQLDelVar", $szSQLCommand); } $szSQLCommand = preg_replace("/\\\$Sequence_Check/", "$Sequence_Check", $szSQLCommand); $szSQLCommand = preg_replace("/\\\$Room/", "$Room", $szSQLCommand); $szSQLCommand = preg_replace("/\\\$Username/", "$Username", $szSQLCommand); $szSQLCommand = preg_replace("/\\\$Query/", "$Query", $szSQLCommand); $szSQLCommand = preg_replace("/\\\$rgRooms\[title\]/", "$rgRooms[title]", $szSQLCommand); $szSQLCommand = preg_replace("/\\\$rgMatches\[3\]/", "$rgMatches[3]", $szSQLCommand); $szSQLCommand = preg_replace("/\\\$rgArgs\[0\]/", "$rgArgs[0]", $szSQLCommand); $szSQLCommand = preg_replace("/\\\$rgArgs\[1\]/", "$rgArgs[1]", $szSQLCommand); $szSQLCommand = preg_replace("/\\\$STATUS\[Sequence\]/", "$STATUS[Sequence]", $szSQLCommand); $szSQLCommand = preg_replace("/\\\$STATUS\[GoRoom\]/", "$STATUS[GoRoom]", $szSQLCommand); return($szSQLCommand); } ?>
