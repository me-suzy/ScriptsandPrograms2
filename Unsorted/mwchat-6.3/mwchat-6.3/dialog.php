<?PHP
  require_once("./libs/requires.php"); require_once("$CONFIG[MWCHAT_Libs]/security.php"); TimeStamp($Username); include("$CONFIG[MWCHAT_Libs]/message.php"); $MetaHeaders .= "  <META HTTP-EQUIV=\"Refresh\" CONTENT=\"$CONFIG[Chat_Refresh_Time] ;URL=dialog.php?Username=$Username&Sequence_Check=$Sequence_Check&Lang=$Lang&Resolution=$Resolution&Room=$Room\">\n"; $MetaHeaders .= "  <SCRIPT LANGUAGE=\"JavaScript\" TYPE=\"text/JavaScript\">\n"; $MetaHeaders .= "    <!--\n"; $MetaHeaders .= "       if (window == top) top.location.href = 'index.php?Logout=$Username&Username=$Username&Lang=$Lang';\n"; $MetaHeaders .= "       function NoBlink()\n"; $MetaHeaders .= "       {\n"; $MetaHeaders .= "         var message;\n"; $MetaHeaders .= "         message= escape(document.Dialog.Message.value);\n"; $MetaHeaders .= "         document.Dialog.Message.value='';\n"; $MetaHeaders .= "         parent.frameNav('links', 'links.php?Username=$Username&Sequence_Check=$Sequence_Check&Lang=$Lang&Resolution=$Resolution&Room=$Room&PrivateUser=' + document.Dialog.PrivateUser.value + '&Message=' + message );\n"; $MetaHeaders .= "         return false;\n"; $MetaHeaders .= "       }\n"; $MetaHeaders .= "    //-->\n"; $MetaHeaders .= "  </SCRIPT>\n"; $STATUS[Silentheader] = "true"; $STATUS[Focus] = "Dialog.Message"; require_once("$CONFIG[MWCHAT_Libs]/header.php"); if ($CONFIG[Database_Encryption] == "false") { $szDialogJs = "onSubmit=\"return NoBlink()\""; } echo "    </CENTER>\n"; echo "    <FORM $szDialogJs AUTOCOMPLETE=\"OFF\" NAME=Dialog ACTION=\"dialog.php?Username=$Username&Sequence_Check=$Sequence_Check&Lang=$Lang&Resolution=$Resolution&Room=$Room&PrivateUser=$PrivateUser\" METHOD=POST>\n"; echo "     <TABLE BORDER=0>\n"; echo "      <TR>\n"; echo "       <TD COLSPAN=2>\n"; if ($Resolution < "1024") { $TextArea = "45"; } else { $TextArea = "60"; } echo "        <INPUT TYPE=TEXT TABINDEX=1 NAME=Message SIZE=$TextArea>\n"; echo "       </TD>\n"; echo "       <TD>\n"; echo "        <INPUT TYPE=SUBMIT VALUE='$LOCALE[DIALOG_Say_Button]'>\n"; echo "       </TD>\n"; echo "      </TR>\n"; echo "      <TR>\n"; echo "       <TD>\n"; echo "        <FONT COLOR=\"$CONFIG[Color_Foreground]\">$LOCALE[DIALOG_Private_Message](" . HelpLink('Private_Message') . "):</FONT COLOR></A>\n"; echo "        <SELECT NAME=\"PrivateUser\">\n"; echo "         <OPTION VALUE=\"\">--------------------</OPTION>\n"; $rgRegistered_SELECT = db_query("SELECT username, ignored_users from chat_registered", $CONN); while($rgIgnoredList = db_fetch($rgRegistered_SELECT)) { $rgSkipDisplay[$rgIgnoredList[username]] = $rgIgnoredList[ignored_users]; } $rgUsers_SELECT = db_query(Validate(7), $CONN); while($rgPrivateList = db_fetch($rgUsers_SELECT)) { if ($rgPrivateList[username] == $Username or $rgPrivateList[room] != $Room) { continue; } if (preg_match("/\*$Username\*/", $rgSkipDisplay[$rgPrivateList[username]])) { continue; } if ($PrivateUser == $rgPrivateList[username]) { echo "         <OPTION SELECTED VALUE=\"$PrivateUser\">$PrivateUser</OPTION>\n"; } else { echo "         <OPTION VALUE=\"$rgPrivateList[username]\">$rgPrivateList[username]</OPTION>\n"; } } echo "        </SELECT><br><A HREF='dialog.php?Username=$Username&Sequence_Check=$Sequence_Check&Lang=$Lang&Resolution=$Resolution&Room=$Room&szRefresh=true'>$LOCALE[DIALOG_Private_Message_Refresh]</A>(" . HelpLink('Private_Message_Refresh') . ")\n"; echo "       </TD>\n"; echo "       </FORM>\n"; echo "       <TD VALIGN=BOTTOM ALIGN=CENTER>\n"; echo "         <TABLE>\n"; echo "           <TR>\n"; echo "            <TD>\n"; echo "              " . HelpLink('Colors'); echo "            </TD>\n"; echo "            <TD>\n"; require_once("$CONFIG[MWCHAT_Libs]/colors.php"); echo "            </TD>\n"; echo "           <TR>\n"; echo "         </TABLE>\n"; $Command = rawurlencode("/clear"); echo "       </TD>\n"; echo "       <FORM NAME=Clear ACTION=\"dialog.php?Message=$Command&Username=$Username&Sequence_Check=$Sequence_Check&Lang=$Lang&Resolution=$Resolution&Room=$Room\" AUTOCOMPLETE=\"OFF\" METHOD=POST>\n"; echo "       <TD>\n"; echo "         <INPUT TYPE=SUBMIT VALUE=\"   $LOCALE[DIALOG_Clear_Window]   \">\n"; echo "       </TD>\n"; echo "       </FORM>\n"; echo "      </TR>\n"; echo "     </TABLE>\n"; echo "    </FORM>\n"; require_once("$CONFIG[MWCHAT_Libs]/footer.php"); ?>
