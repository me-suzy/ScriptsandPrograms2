<?PHP
  require_once("./libs/requires.php"); require_once("$CONFIG[MWCHAT_Libs]/security.php"); TimeStamp($Username); $STATUS[Silentheader] = "true"; require_once("$CONFIG[MWCHAT_Libs]/header.php"); echo "  <H2>\n"; echo "    $LOCALE[MYFILES_File_Title]\n"; echo "  </H2>\n"; echo "  <HR>\n"; echo "  <CENTER>\n"; if ($CONFIG[Chat_Upload] != "true") { $STATUS[Registered] = "no"; } if ($STATUS[Registered] == "yes") { if ($Action == "GO") { if (is_array($_POST)) { while(list($szNull, $szVariable) = each($_POST)) { if (preg_match("/REMOVE_FILE\-(.*)/", $szNull)) { if (file_exists("$CONFIG[System_Root]/$CONFIG[MWCHAT_Upload]/$Username/$szVariable")) { unlink("$CONFIG[System_Root]/$CONFIG[MWCHAT_Upload]/$Username/$szVariable"); } } } } unset($Action); } if ($Action != "GO") { echo "  <FORM NAME=Upload ACTION=\"myfiles.php?Action=GO\" AUTOCOMPLETE=\"OFF\" METHOD=POST>\n"; echo "  <INPUT TYPE=HIDDEN NAME=Username VALUE=\"$Username\">\n"; echo "  <INPUT TYPE=HIDDEN NAME=Lang VALUE=\"$Lang\">\n"; echo "  <INPUT TYPE=HIDDEN NAME=Room VALUE=\"$Room\">\n"; echo "  <INPUT TYPE=HIDDEN NAME=Resolution VALUE=\"$Resolution\">\n"; echo "  <INPUT TYPE=HIDDEN NAME=Sequence_Check VALUE=\"$Sequence_Check\">\n"; echo "  $LOCALE[MYFILES_File_Info]<BR><BR>\n"; $szTHeader = "  <TABLE BORDER=0 CELLSPACING=5 CELLPADDING=5>\n"; $szTHeader .= "   <TR>\n"; $szTHeader .= "     <TD>\n"; $szTHeader .= "        <B><U>$LOCALE[MYFILES_Remove]</B></U>\n"; $szTHeader .= "     </TD>\n"; $szTHeader .= "     <TD>\n"; $szTHeader .= "        <B><U>$LOCALE[MYFILES_From]</B></U>\n"; $szTHeader .= "     </TD>\n"; $szTHeader .= "     <TD>\n"; $szTHeader .= "        <B><U>$LOCALE[MYFILES_Time]</B></U>\n"; $szTHeader .= "     </TD>\n"; $szTHeader .= "     <TD>\n"; $szTHeader .= "        <B><U>$LOCALE[MYFILES_Size]</B></U>\n"; $szTHeader .= "     </TD>\n"; $szTHeader .= "     <TD>\n"; $szTHeader .= "        <B><U>$LOCALE[MYFILES_Name]</B></U>\n"; $szTHeader .= "     </TD>\n"; $szTHeader .= "   </TR>\n"; if (is_dir("$CONFIG[System_Root]/$CONFIG[MWCHAT_Upload]/$Username")) { $hFiles = opendir("$CONFIG[System_Root]/$CONFIG[MWCHAT_Upload]/$Username"); $szCounter = "1"; $szUsedSpace = "0"; while($szFileName = readdir($hFiles)) { if ($szFileName != "." && $szFileName != ".." && $szFileName != "index.php") { $szHasFiles = "TRUE"; $rgFileParts = explode("----", $szFileName); clearstatcache(); $rgFileInfo = stat("$CONFIG[System_Root]/$CONFIG[MWCHAT_Upload]/$Username/$szFileName"); $szDate = date ("M d, Y", $rgFileInfo[mtime]); $szTime = date ("h:i A", $rgFileInfo[mtime]); $szUsedSpace = ($rgFileInfo[size] + $szUsedSpace); $rgFileInfo[size] = round(($rgFileInfo[size] / 1000), 1); $szTdata .= "   <TR>\n"; $szTdata .= "     <TD>\n"; $szTdata .= "        <INPUT TYPE='CHECKBOX' NAME=\"REMOVE_FILE-$szCounter\" VALUE=\"$szFileName\">\n"; $szTdata .= "     </TD>\n"; $szTdata .= "     <TD>\n"; $szTdata .= "        $rgFileParts[0]\n"; $szTdata .= "     </TD>\n"; $szTdata .= "     <TD>\n"; $szTdata .= "        $szDate <br> $szTime\n"; $szTdata .= "     </TD>\n"; $szTdata .= "     <TD ALIGN=RIGHT>\n"; $szTdata .= "        $rgFileInfo[size] k\n"; $szTdata .= "     </TD>\n"; $szTdata .= "     <TD>\n"; $szTdata .= "       <A HREF='#' OnClick=\"window.open('view.php?Username=$Username&Sequence_Check=$Sequence_Check&Lang=$Lang&Resolution=$Resolution&Room=$Room&FN=$szFileName', 'VIEW$szCounter', 'width=500,height=200,scrollbars,resizable=yes');\">$rgFileParts[1]</A>\n"; $szTdata .= "     </TD>\n"; $szTdata .= "   </TR>\n"; $szCounter++; } } closedir($hFiles); } echo $szTHeader; $szLeftSpace = round((($CONFIG[Chat_Upload_Limit] - $szUsedSpace) / 1000), 1); $szDisplaySpace = ($CONFIG[Chat_Upload_Limit] / 1000); echo "  <FONT SIZE='2'>$LOCALE[MYFILES_Storage]: <FONT COLOR='$CONFIG[Color_StatusValues]'>$szLeftSpace k <B>/</B> $szDisplaySpace k </FONT COLOR></FONT SIZE>(" . HelpLink('Storage') . ")\n"; echo $szTdata; if ($szHasFiles != "TRUE") { echo "   <TR>\n"; echo "     <TD COLSPAN='5'>\n"; echo "       <BR> <CENTER><B>$LOCALE[MYFILES_File_None]</B></CENTER><BR>\n"; echo "     </TD>\n"; echo "   </TR>\n"; } else { echo "   <TR>\n"; echo "     <TD COLSPAN='5' ALIGN=CENTER>\n"; echo "       <BR> <INPUT TYPE=SUBMIT VALUE=\"$LOCALE[MYFILES_File_Button]\">\n"; echo "     </TD>\n"; echo "   </TR>\n"; } echo "  </TABLE>\n"; } echo "  <CENTER>\n"; } else { echo "  <BR><BR><CENTER><B>/myfiles $LOCALE[COMMON_Registered_Only]</B></CENTER><BR><BR><BR><BR>\n"; } echo "  <HR><CENTER><A HREF=\"#\" onClick=\"self.close()\">$LOCALE[COMMON_Click_Close]</A></CENTER>\n"; require_once("$CONFIG[MWCHAT_Libs]/footer.php"); ?>
