<?PHP
  require_once("./libs/requires.php"); require_once("$CONFIG[MWCHAT_Libs]/security.php"); Update_TimeStamp($Username); $rgProcess_DELETE = db_query(Validate(24), $CONN); $rgText_DELETE = db_query(Validate(25), $CONN); $rgUsers_DELETE = db_query(Validate(26), $CONN); if ($NewPublic != "" or $NewPrivate != "" or $RoomPublic != "" or $RoomPrivate != "") { require_once("$CONFIG[MWCHAT_Libs]/start_chat.php"); } include("$CONFIG[MWCHAT_Libs]/chat_maintainance.php"); $MetaHeaders .= "  <SCRIPT LANGUAGE=\"JavaScript\" TYPE=\"text/JavaScript\">\n"; $MetaHeaders .= "    <!--\n"; $MetaHeaders .= "       function Unselect(form,field)\n"; $MetaHeaders .= "       {\n"; $MetaHeaders .= "         document[form][field].selectedIndex=-1;\n"; $MetaHeaders .= "       }\n"; $MetaHeaders .= "    //-->\n"; $MetaHeaders .= "  </SCRIPT>\n"; $FooterJava = "  <SCRIPT LANGUAGE=\"JavaScript\" TYPE=\"text/JavaScript\">\n"; $FooterJava .= "   <!--\n"; $FooterJava .= "     if (window != top) top.location.href = location.href;\n"; $FooterJava .= "   // -->\n"; $FooterJava .= "  </SCRIPT>\n"; if ($CONFIG[Room_MultiplePublic] == "true") { $STATUS[Focus] = "Lobby.NewPublic"; } require_once("$CONFIG[MWCHAT_Libs]/header.php"); echo "    <FORM NAME=Lobby ACTION=\"lobby.php\" AUTOCOMPLETE=\"OFF\" METHOD=POST>\n"; echo "     <INPUT TYPE=HIDDEN NAME=Username VALUE=\"$Username\">\n"; echo "     <INPUT TYPE=HIDDEN NAME=Lang VALUE=\"$Lang\">\n"; echo "     <INPUT TYPE=HIDDEN NAME=Resolution VALUE=\"$Resolution\">\n"; echo "     <INPUT TYPE=HIDDEN NAME=Sequence_Check VALUE=\"$Sequence_Check\">\n"; echo "     <H2>\n"; echo "        $LOCALE[LOBBY_Room_Title]\n"; echo "     </H2>\n"; if (isset($STATUS[Lobby_Error])) { echo "     <H3>\n"; echo "        $STATUS[Lobby_Error]\n"; echo "     </H3>\n"; } echo "     <TABLE BORDER='0' CELLPADDING=5 CELLSPACING=5>\n"; echo "      <TR>\n"; if ($CONFIG[Room_PrivateOnly] != "true") { echo "        <TD>\n"; echo "          <I><U><B>$LOCALE[LOBBY_Public_List]</B></U></I> (" . HelpLink('Lobby_Public') . "):\n"; echo "        </TD>\n"; echo "        <TD>\n"; if ($CONFIG[Room_MultiplePublic] == "true") { echo "          <I><U><B>$LOCALE[LOBBY_Create_Public]</B></U></I> (" . HelpLink('Lobby_Public_Create') . "):\n"; } else { echo "          &nbsp;\n"; } echo "        </TD>\n"; } echo "      </TR>\n"; echo "      <TR>\n"; if ($CONFIG[Room_PrivateOnly] != "true") { echo "        <TD>\n"; echo "          <SELECT onFocus=\"Unselect('Lobby','RoomPrivate') ; document.Lobby.NewPrivate.value = ''; document.Lobby.NewPublic.value = ''\" TABINDEX=1 SIZE=10 NAME=RoomPublic>\n"; $rgActiveRooms = array(); $rgRooms_SELECT = db_query(Validate(12), $CONN); $szTotalRooms = db_numrows($rgRooms_SELECT); if ($szTotalRooms != "0") { while($rgRooms = db_fetch($rgRooms_SELECT)) { $rgUsers_SELECT = db_query(Validate(14), $CONN); $szUsers = db_numrows($rgUsers_SELECT); if ($szUsers < $CONFIG[Room_Visitors]) { $rgRooms[title] = Clean_Variable($rgRooms[title], "all"); $rgRooms[title] = Profanity_Check($rgRooms[title], "clean"); array_push($rgActiveRooms, $rgRooms[title]); $rgVisitors[$rgRooms[title]] = $szUsers; } } } reset($CONFIG[Room_Defaults]); while (list($szNull, $szRoom) = each($CONFIG[Room_Defaults])) { $rgRoomPart = explode(":", $szRoom); $szDisplayRoom = $rgRoomPart[0]; $rgRoomPart[0] = Clean_Variable($rgRoomPart[0], "all"); $rgRoomPart[0] = Profanity_Check($rgRoomPart[0], "clean"); if (!isset($rgVisitors[$rgRoomPart[0]])) { $rgVisitors[$rgRoomPart[0]] = "0"; } $rgDefaultDisplayRM[$rgRoomPart[0]] = $szDisplayRoom; array_push($rgActiveRooms, $rgRoomPart[0]); } $rgDisplayRooms = array_unique($rgActiveRooms); while (list($szNull, $szRoom) = each($rgDisplayRooms)) { if (isset($rgDefaultDisplayRM[$szRoom])) { $szOptionDisplay = "$rgDefaultDisplayRM[$szRoom] - $rgVisitors[$szRoom] $LOCALE[LOBBY_Visitors]"; } else { $szOptionDisplay = "$szRoom - $rgVisitors[$szRoom] $LOCALE[LOBBY_Visitors]"; } if (strlen($szOptionDisplay) > "35") { $szOptionDisplay = substr($szOptionDisplay, 0, 35); } echo "             <OPTION VALUE='$szRoom'>$szOptionDisplay</OPTION>\n"; } echo "             <OPTION VALUE=''>-----------------------------------</OPTION>\n"; echo "           </SELECT>\n"; echo "        </TD>\n"; echo "        <TD VALIGN='TOP'>\n"; if ($CONFIG[Room_MultiplePublic] == "true") { echo "          <B>$LOCALE[COMMON_Room_Name](" . HelpLink('Room', 1) . "):</B><BR><INPUT onFocus=\"document.Lobby.NewPrivate.value = ''; Unselect('Lobby','RoomPrivate') ; Unselect('Lobby','RoomPublic')\" TYPE='TEXT' NAME='NewPublic' TABINDEX='3' SIZE='20' MAXLENGTH='20'>\n"; } else { echo "          &nbsp;\n"; } echo "        </TD>\n"; } echo "      </TR>\n"; echo "      <TR>\n"; if ($CONFIG[Room_MultiplePrivate] == "true") { echo "        <TD>\n"; echo "          <I><U><B>$LOCALE[LOBBY_Private_List]</B></U></I> (" . HelpLink('Lobby_Private') . "):\n"; echo "        </TD>\n"; echo "        <TD>\n"; echo "          <I><U><B>$LOCALE[LOBBY_Create_Private]</B></U></I> (" . HelpLink('Lobby_Private_Create') . "):\n"; echo "        </TD>\n"; } echo "      </TR>\n"; echo "      <TR>\n"; if ($CONFIG[Room_MultiplePrivate] == "true") { echo "        <TD>\n"; echo "          <SELECT onFocus=\"Unselect('Lobby','RoomPublic') ; document.Lobby.NewPrivate.value = ''; document.Lobby.NewPublic.value = ''\" TABINDEX=2 SIZE=10 NAME=RoomPrivate>\n"; if ($CONFIG[Room_Admin_ShowPrivate] == "true" and $STATUS[Admin] == "yes") { $rgRooms_SELECT = db_query(Validate(13), $CONN); $szRooms = db_numrows($rgRooms_SELECT); if ($szRooms != "0") { while($rgRooms = db_fetch($rgRooms_SELECT)) { $rgUsers_SELECT = db_query(Validate(14), $CONN); $szUsers = db_numrows($rgUsers_SELECT); $rgRooms[title] = Clean_Variable($rgRooms[title], "all"); $szOptionDisplay = "$rgRooms[title] - $szUsers $LOCALE[LOBBY_Visitors]"; if (strlen($szOptionDisplay) > "35") { $szOptionDisplay = substr($szOptionDisplay, 0, 35); } echo "             <OPTION VALUE='$rgRooms[title]'>$szOptionDisplay</OPTION>\n"; } } echo "             <OPTION VALUE=''>-----------------------------------</OPTION>\n"; } else { echo "             <OPTION VALUE=''>-------------$LOCALE[LOBBY_Hidden]-------------</OPTION>\n"; } echo "          </SELECT>\n"; echo "        </TD>\n"; } if ($CONFIG[Room_MultiplePrivate] == "true") { echo "        <TD VALIGN='TOP'>\n"; echo "         <B>$LOCALE[COMMON_Room_Name](" . HelpLink('Room', 1) . "):</B><BR><INPUT onFocus=\"document.Lobby.NewPublic.value = ''; Unselect('Lobby','RoomPrivate') ; Unselect('Lobby','RoomPublic')\" TYPE='TEXT' NAME='NewPrivate' TABINDEX='4' SIZE='20' MAXLENGTH='20'><BR><BR><BR>\n"; echo "         <B>$LOCALE[LOBBY_Room_Password](" . HelpLink('Room_Password', 1) . "):</B><BR><INPUT onFocus=\"document.Lobby.NewPublic.value = ''; Unselect('Lobby','RoomPrivate') ; Unselect('Lobby','RoomPublic')\" TYPE='PASSWORD' NAME='NewPrivatePass' TABINDEX='5' SIZE='20' MAXLENGTH='20'>\n"; echo "        </TD>\n"; } echo "      </TR>\n"; echo "      <TR>\n"; echo "      </TR>\n"; echo "      <TR>\n"; echo "        <TD>\n"; echo "          <INPUT TYPE=SUBMIT TABINDEX=6 VALUE=\"$LOCALE[LOBBY_Button]\">\n"; echo "        </TD>\n"; echo "        </FORM>\n"; echo "        <FORM NAME=Logout ACTION=\"index.php?Logout=$Username&Username=$Username&Lang=$Lang\" AUTOCOMPLETE=\"OFF\" METHOD=POST>\n"; echo "        <TD>\n"; echo "          <INPUT TYPE=SUBMIT TABINDEX=7 VALUE=\"$LOCALE[COMMON_Logout]\">\n"; echo "        </TD>\n"; echo "        </FORM>\n"; echo "      </TR>\n"; echo "     </TABLE>\n"; require_once("./$CONFIG[MWCHAT_Libs]/footer.php"); ?>
