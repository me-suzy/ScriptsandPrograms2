<?php
/***************************************************************************
*	Very Simple News System
*	Version: 3.1.1
*	Filename: rss.xml
*	Description: RSS Feed
****************************************************************************
*	Build Date: July 19, 2005
*	Author: Tachyon
*	Website: http://tachyondecay.net
****************************************************************************
*	Copyright Â© 2005 by Tachyon
*
*	This program is free software; you can redistribute it and/or modify
*   it under the terms of the GNU General Public License as published by
*   the Free Software Foundation; either version 2 of the License, or
*   (at your option) any later version.  A copy of the GPL version 2 is
*	included with this package in the file "COPYING.TXT"
*
*   This program is distributed in the hope that it will be useful,
*   but WITHOUT ANY WARRANTY; without even the implied warranty of
*   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
*    GNU General Public License for more details.
*
*   You should have received a copy of the GNU General Public License
*   along with this program; if not, write to the Free Software
*   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
****************************************************************************/

header('Content-type: text/xml');

//Include global settings
include "settings.php";

$month = date("m");
$year = date("Y");

?>
<rss version="2.0">
	<channel>
		<title><?php echo $sitename; ?></title>
		<description><?php echo $desc; ?></description>
		<link><?php echo $website; ?></link>
		<copyright>Copyright 2005 <?php echo $cright; ?>.  All rights reserved.</copyright>

<?php

//Get all articles for the month and year
$query = mysql_query("SELECT ID,heading,content,month,day,year,pubDate FROM vsns_news ORDER BY ID DESC LIMIT 10") or die(mysql_error());

if ($query && mysql_num_rows($query) > 0);
{
	while ($row = mysql_fetch_array($query))
	{
		//Start building the proper information
		//Title, description, link, and date

		$heading = strip_tags($row["heading"]);
		$heading = htmlentities($heading, ENT_QUOTES);

		$content = strip_tags($row["content"]);
		$content = htmlentities($content, ENT_QUOTES);
		$content = substr($content, 0, 250);
		$content = preg_replace('/\s+\S*$/', '', $content)."...";

		$link = $path."archives/".$row["year"]."/".$row["month"]."/".$row["day"]."/".$row["ID"]."/";

		if ($row["pubDate"] == 0)
		{
			$timestamp = mktime("00", "00", "00", $row["month"], $row["day"], $row["year"], -1);
			$pubDate = date("D, d M Y H:i:s T", $timestamp);
		}
		else
		{
			$pubDate = strftime("%a, %d %b %Y %T %Z", $row["pubDate"]);
		}

$item = <<<WOOT
		<item>
			<title>$heading</title>
			<description>$content</description>
			<link>$link</link>
			<pubDate>$pubDate</pubDate>
		</item>
WOOT;
		echo $item;
	}
	mysql_free_result($query);
}
?>
	</channel>
</rss>