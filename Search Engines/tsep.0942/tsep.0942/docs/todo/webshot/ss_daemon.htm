http://kicken.mine.nu:8008/extras/webshot/ss_daemon

<code><font color="#000000">
#!/usr/local/bin/php -q<br /><font color="#0000BB">&lt;?php<br /></font><font color="#FF8000">/************************************************<br /> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Screen Capture script&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br /> *&nbsp;&nbsp;&nbsp;&nbsp;Written by: Keith (aka kicken)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br /> *&nbsp;&nbsp;&nbsp;&nbsp;Email: keithm@aoeex.com&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br /> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br /> *&nbsp;&nbsp;&nbsp;&nbsp;What's it do?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br /> *&nbsp;&nbsp;&nbsp;&nbsp;This script takes a URL and creates a &nbsp;&nbsp;&nbsp;&nbsp;*<br /> *graphic of the url that can be displayed.&nbsp;&nbsp;&nbsp;&nbsp;*<br /> *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br /> *&nbsp;&nbsp;&nbsp;&nbsp;How's it do that?&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br /> *&nbsp;&nbsp;&nbsp;&nbsp;It's quite simple, but does require a &nbsp;&nbsp;&nbsp;&nbsp;*<br /> *few things.&nbsp;&nbsp;First, you need some sort of a &nbsp;&nbsp;&nbsp;&nbsp;*<br /> *web browser that can be called up with a &nbsp;&nbsp;&nbsp;&nbsp;*<br /> *defualt URL on the command line and supports&nbsp;&nbsp;&nbsp;&nbsp;*<br /> *javascript.&nbsp;&nbsp;Second, you need to have &nbsp;&nbsp;&nbsp;&nbsp;*<br /> *Imagemagick (specifically the import&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br /> *command).&nbsp;&nbsp;This is used to take a screen &nbsp;&nbsp;&nbsp;&nbsp;*<br /> *capture a few seconds after the web browser &nbsp;&nbsp;&nbsp;&nbsp;*<br /> *has been launched.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*<br /> ************************************************/<br /><br /></font><font color="#0000BB">$path_to_browser</font><font color="#007700">=</font><font color="#DD0000">'/usr/local/bin/mozilla'</font><font color="#007700">;<br /></font><font color="#0000BB">$path_to_import</font><font color="#007700">=</font><font color="#DD0000">'/usr/X11R6/bin/import'</font><font color="#007700">;<br /></font><font color="#0000BB">$path_to_output</font><font color="#007700">=</font><font color="#DD0000">'/home/kicken/data/extras/webshot/images'</font><font color="#007700">;<br /></font><font color="#0000BB">$path_to_redirect</font><font color="#007700">=</font><font color="#DD0000">'file:///home/kicken/data/extras/webshot/ss.html'</font><font color="#007700">;<br /></font><font color="#0000BB">$crop</font><font color="#007700">=</font><font color="#DD0000">'781x549+2+44'</font><font color="#007700">;<br /></font><font color="#0000BB">$format</font><font color="#007700">=</font><font color="#DD0000">'.jpg'</font><font color="#007700">;<br /></font><font color="#0000BB">$quality</font><font color="#007700">=</font><font color="#0000BB">85</font><font color="#007700">;<br /></font><font color="#0000BB">$timeout</font><font color="#007700">=</font><font color="#0000BB">60</font><font color="#007700">;<br /><br /></font><font color="#FF8000">//// Stop Editing Here!!!!!! //////<br /><br /><br /></font><font color="#007700">function </font><font color="#0000BB">fixchars</font><font color="#007700">(</font><font color="#0000BB">$str</font><font color="#007700">){<br />&nbsp;&nbsp;&nbsp;&nbsp;return </font><font color="#0000BB">preg_replace</font><font color="#007700">(</font><font color="#DD0000">'/[^a-zA-Z0-9_]/'</font><font color="#007700">, </font><font color="#DD0000">'_'</font><font color="#007700">, </font><font color="#0000BB">$str</font><font color="#007700">);<br />}<br /><br /></font><font color="#0000BB">set_time_limit</font><font color="#007700">(</font><font color="#0000BB">0</font><font color="#007700">);<br />include(</font><font color="#DD0000">'mysql_connect.php'</font><font color="#007700">);<br />while (</font><font color="#0000BB">$res</font><font color="#007700">=</font><font color="#0000BB">mysql_query</font><font color="#007700">(</font><font color="#DD0000">'SELECT ID, url FROM ss_que'</font><font color="#007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;while (</font><font color="#0000BB">$row</font><font color="#007700">=</font><font color="#0000BB">mysql_fetch_object</font><font color="#007700">(</font><font color="#0000BB">$res</font><font color="#007700">)){<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$url</font><font color="#007700">=</font><font color="#0000BB">$row</font><font color="#007700">-&gt;</font><font color="#0000BB">url</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//First, we launch the browser with the url, escape shell characters to avoid hacks.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//We don't want to wait for the browser.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">echo </font><font color="#DD0000">'Launching browser with the url '</font><font color="#007700">, </font><font color="#0000BB">$url</font><font color="#007700">, </font><font color="#DD0000">'.'</font><font color="#007700">, </font><font color="#0000BB">chr</font><font color="#007700">(</font><font color="#0000BB">10</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">$browserargs</font><font color="#007700">=</font><font color="#0000BB">$path_to_redirect</font><font color="#007700">.</font><font color="#DD0000">'?'</font><font color="#007700">.</font><font color="#0000BB">urlencode</font><font color="#007700">(</font><font color="#0000BB">$url</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">system</font><font color="#007700">(</font><font color="#0000BB">$path_to_browser</font><font color="#007700">.</font><font color="#DD0000">' '</font><font color="#007700">.</font><font color="#0000BB">escapeshellarg</font><font color="#007700">(</font><font color="#0000BB">$browserargs</font><font color="#007700">).</font><font color="#DD0000">' &gt;/dev/null 2&gt;&amp;1 &amp;'</font><font color="#007700">);<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Now we wait for the browser to launch.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#007700">echo </font><font color="#DD0000">'Sleeping for '</font><font color="#007700">, </font><font color="#0000BB">$timeout</font><font color="#007700">, </font><font color="#DD0000">' seconds while things load and get rendered...'</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">flush</font><font color="#007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">sleep</font><font color="#007700">(</font><font color="#0000BB">$timeout</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#0000BB">chr</font><font color="#007700">(</font><font color="#0000BB">10</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">'Taking a screen capture and saving to path: '</font><font color="#007700">, </font><font color="#0000BB">$path_to_output</font><font color="#007700">, </font><font color="#DD0000">'/'</font><font color="#007700">, </font><font color="#0000BB">fixchars</font><font color="#007700">(</font><font color="#0000BB">$url</font><font color="#007700">), </font><font color="#0000BB">chr</font><font color="#007700">(</font><font color="#0000BB">10</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">flush</font><font color="#007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#FF8000">//Now, we take a screen capture.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">system</font><font color="#007700">(</font><font color="#0000BB">$path_to_import</font><font color="#007700">.</font><font color="#DD0000">' -silent -window root -crop '</font><font color="#007700">.</font><font color="#0000BB">$crop</font><font color="#007700">.</font><font color="#DD0000">' -quality '</font><font color="#007700">.</font><font color="#0000BB">$quality</font><font color="#007700">.</font><font color="#DD0000">' '</font><font color="#007700">.</font><font color="#0000BB">$path_to_output</font><font color="#007700">.</font><font color="#DD0000">'/'</font><font color="#007700">.</font><font color="#0000BB">fixchars</font><font color="#007700">(</font><font color="#0000BB">$url</font><font color="#007700">).</font><font color="#0000BB">$format</font><font color="#007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo </font><font color="#DD0000">'Finished.&nbsp;&nbsp;The screen capture has been saved to: '</font><font color="#007700">, </font><font color="#0000BB">$path_to_output</font><font color="#007700">, </font><font color="#DD0000">'/'</font><font color="#007700">, </font><font color="#0000BB">fixchars</font><font color="#007700">(</font><font color="#0000BB">$url</font><font color="#007700">), </font><font color="#0000BB">$format</font><font color="#007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">mysql_query</font><font color="#007700">(</font><font color="#DD0000">'DELETE FROM ss_que WHERE id="'</font><font color="#007700">.</font><font color="#0000BB">$row</font><font color="#007700">-&gt;</font><font color="#0000BB">ID</font><font color="#007700">.</font><font color="#DD0000">'"'</font><font color="#007700">) or die(</font><font color="#DD0000">'Unable to delete from que'</font><font color="#007700">.</font><font color="#0000BB">mysql_error</font><font color="#007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000BB">sleep</font><font color="#007700">(</font><font color="#0000BB">1</font><font color="#007700">);<br />}<br /><br /></font><font color="#0000BB">?&gt;<br /></font>
</font>
</code>